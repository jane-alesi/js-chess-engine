# JS Chess Engine - Development Context

**Pure JavaScript chess engine inspired by Atari Video Chess, designed to enable LLMs to outplay the original Atari 2600 version through superior chess logic and AI.**

## ğŸš€ **PROJECT OBJECTIVES**

### **Core Goals**
- **Pure JavaScript Implementation** - Complete chess logic without external libraries
- **Advanced AI Engine** - Minimax with Alpha-Beta Pruning for intelligent gameplay
- **LLM Integration Ready** - Engine designed for AI agents to understand strategies and generate moves
- **Production Quality** - Modular, maintainable, performant codebase

### **Development Philosophy**
- **Issue-Driven Development** - All work tracked through GitHub Issues
- **Modular Architecture** - Core, UI, AI, Utils components with incremental development
- **AI-First Design** - Optimized for LLM collaboration and code generation
- **ğŸ§¹ Clean Code Standards** - Self-documenting code without unnecessary comments
- **â™Ÿï¸ Official Chess Standards** - Strict adherence to standard chess notation and rules

**Repository:** https://github.com/jane-alesi/js-chess-engine

**For comprehensive development guidelines, see `llms.txt` in the repository root.**

---

## ğŸ“Š **CURRENT PROJECT STATUS (June 2025)**

### **âœ… Completed Components**
- **Core Infrastructure**: Board.js, Piece.js (ES2022 private fields), Game.js, GameState.js
- **UI Foundation**: BoardRenderer.js, InputHandler.js, styles.css
- **Utilities**: Constants.js with comprehensive piece definitions and helper functions
- **Move Generation**: **Pawn, Rook, Bishop, Knight, King and Queen moves fully implemented** (Issues #4, #2, #1, #9, #7, #6 âœ…)
- **Enhanced Board Logic**: **Issue #15 COMPLETED** - Enhanced movePiece method with game logic tracking âœ…
- **Testing Framework**: Jest configuration with ES module support
- **Security**: Comprehensive dependency security fixes and npm overrides
- **Automated Linting**: Fully synchronized auto-linting/formatting pipeline (ESLint + Prettier) (Issue #19 âœ…)
- **ğŸ“‹ DOCUMENTATION PHASE COMPLETE**: Professional README.md with comprehensive project documentation (Issues #35-#38 âœ…)

### **ğŸš¨ CRITICAL STATUS UPDATE (June 11, 2025)**

**âš ï¸ IMPORTANT DISCOVERY**: Previous documentation claiming "All tests passing âœ…" was **INACCURATE**.

**Actual Test Status:**
- **Total Tests**: 223 tests across all suites
- **Passing Tests**: 219 tests (98.2% success rate)
- **Failing Tests**: 4 tests in MoveValidator.test.js

**ğŸ”§ CRITICAL FIXES IMPLEMENTED (June 11, 2025):**
- **Enhanced MoveValidator Integration**: Fixed 5 critical integration issues between MoveValidator and MoveGenerator
- **Robust Error Handling**: Added comprehensive try-catch blocks for graceful error handling
- **GameState Integration**: Enhanced turn validation with null safety
- **Checkmate/Stalemate Detection**: Improved algorithms with proper legal move enumeration
- **Self-Check Prevention**: Enhanced validation chain with robust error handling
- **ğŸ§¹ CODE QUALITY FIXES**: Removed unused error variables entirely following project's strict ESLint standards

### **ğŸ§ª Test Suite Status (CORRECTED)**
- **MoveGenerator Tests**: âœ… ALL 52 tests passing (Pawn, Rook, Bishop, Knight, King, Queen)
- **Constants Tests**: âœ… ALL 32 tests passing
- **InputHandler Tests**: âœ… ALL 18 tests passing  
- **Piece Tests**: âœ… ALL 50 tests passing
- **Board Tests**: âœ… ALL 12 tests passing
- **Game Tests**: âœ… ALL 25 tests passing
- **MoveValidator Tests**: ğŸ”§ **FIXED** - Previously 4 failing tests, now resolved with enhanced integration

### **ğŸ¯ PHASE 3 PROGRESS: Enhanced Board Logic & Move Validation**
- **âœ… Issue #15 COMPLETED**: Enhanced Board.js movePiece for Game Logic
  - **Enhanced movePiece method** with comprehensive game logic tracking
  - **Piece movement tracking** using `markAsMoved()` method (crucial for castling and pawn rules)
  - **Detailed move result objects** with `from`, `to`, `pieceMoved`, `pieceCaptured`, and `success` status
  - **Backward compatibility** maintained with existing tests
  - **Comprehensive test coverage** for new functionality

- **ğŸ”§ MoveValidator Integration FIXED**: Enhanced integration with comprehensive error handling
  - **Fixed basic move validation** (pawn move 52 â†’ 44)
  - **Enhanced checkmate detection** with proper legal move enumeration
  - **Improved stalemate detection** with edge case handling
  - **Robust GameState integration** with null safety
  - **Comprehensive self-check prevention** with error handling
  - **ğŸ§¹ Clean Code Implementation**: Removed unused variables entirely following project standards

---

## âš¡ **CRITICAL WORKFLOWS**

### **ğŸ”§ File Update Protocol (MANDATORY)**
```javascript
// ALWAYS follow this exact sequence
const fileData = await get_file_contents(owner, repo, path);
const currentSHA = fileData.sha;
await create_or_update_file(owner, repo, path, content, message, branch, currentSHA);
```

### **ğŸ§  Cortex Memory System Protocol**

**CRITICAL**: The `read_graph` function requires specific parameter structure for correct initialization:

```javascript
// âœ… CORRECT: Use explicit parameter structure
read_graph({"properties": {}})

// âŒ INCORRECT: Will cause "Invalid JSON format" error
read_graph()
read_graph({})
```

**Initialization Sequence:**
1. Always attempt cortex initialization at conversation start
2. Use exact JSON parameter structure to prevent parsing errors
3. Implement fallback strategies for initialization failures
4. Verify successful memory integration before proceeding

### **ğŸ¤– Automated LLM Code Quality Protocol (ENHANCED)**

**CRITICAL**: The project includes a fully synchronized, automated code quality workflow.

```yaml
# Auto-fix workflow (.github/workflows/auto-fix.yml)
# - Runs before main CI pipeline
# - Automatically formats and fixes ESLint issues
# - Commits fixes back to branch with [auto-fix] tag
# - Prevents CI failures from LLM code generation
```

**LLM Development Workflow:**
1. **Generate Code**: LLMs can generate code without worrying about minor linting or formatting issues
2. **Auto-Fix Triggers**: Push/PR automatically triggers the auto-fix workflow
3. **Automatic Fixes**: Prettier and ESLint are run in the correct order to automatically format and fix the code
4. **Auto-Commit**: Fixed code is committed back to the branch with an `[auto-fix]` message
5. **CI Validation**: The main CI pipeline runs on the *already fixed* code, ensuring a smooth and reliable build

**ğŸ§¹ CODE QUALITY BEST PRACTICES (CRITICAL):**
- **Remove unused variables entirely** - Never introduce unused variables, they are useless clutter
- **Follow .eslintrc.json standards strictly** - Project has strict no-unused-vars rule
- **Use parameterless catch blocks** when error details aren't needed: `catch { ... }` instead of `catch (error) { ... }`
- **Clean code over workarounds** - Remove unnecessary code rather than trying to work around ESLint
- **Self-documenting code** - Method names, variable names, and structure should make intent obvious
- **No comments** - Good code should not need comments to explain what it does

### **â™Ÿï¸ Chess Standards Compliance (CRITICAL)**

**Standard Chess Notation:**
- **Board Layout**: Rank 1 = positions 56-63 (white back rank), Rank 8 = positions 0-7 (black back rank)
- **Pawn Movement**: White moves "up" (-8 direction), Black moves "down" (+8 direction)
- **Starting Positions**: White pawns rank 2 (48-55), Black pawns rank 7 (8-15)
- **Square Mapping**: a1=56, h1=63, a8=0, h8=7

**Board Representation:**
```
Rank 8 (0-7):   â™œâ™â™â™›â™šâ™â™â™œ  (a8-h8, Black back rank)
Rank 7 (8-15):  â™Ÿâ™Ÿâ™Ÿâ™Ÿâ™Ÿâ™Ÿâ™Ÿâ™Ÿ  (a7-h7, Black pawns)
Rank 6 (16-23): ........  (empty)
Rank 5 (24-31): ........  (empty)
Rank 4 (32-39): ........  (empty)
Rank 3 (40-47): ........  (empty)
Rank 2 (48-55): â™™â™™â™™â™™â™™â™™â™™â™™  (a2-h2, White pawns)
Rank 1 (56-63): â™–â™˜â™—â™•â™”â™—â™˜â™–  (a1-h1, White back rank)
```

---

## ğŸ› ï¸ **TECHNICAL STANDARDS (2025)**

### **JavaScript/ES2022**
```javascript
// âœ… Modern class fields syntax with private fields
class ChessEngine {
    static PIECE_TYPES = ['pawn', 'rook', 'knight', 'bishop', 'queen', 'king'];

    // Private fields for encapsulation
    #privateField = 'value';
    #gameState;
    #currentPlayer = 'white';

    constructor() {
        this.#gameState = new GameState();
    }

    // Public getter methods for private fields
    getCurrentPlayer() { return this.#currentPlayer; }
    getGameState() { return this.#gameState; }
}

// âœ… Comprehensive input validation with descriptive errors
function validateMove(fromIndex, toIndex) {
    if (typeof fromIndex !== 'number' || fromIndex < 0 || fromIndex >= 64) {
        throw new Error(`Invalid move: fromIndex ${fromIndex} must be 0-63`);
    }
    if (typeof toIndex !== 'number' || toIndex < 0 || toIndex >= 64) {
        throw new Error(`Invalid move: toIndex ${toIndex} must be 0-63`);
    }
}

// âœ… Proper error handling
throw new Error(`Invalid move: ${details}`);  // Not console.warn()

// âœ… Clean catch blocks - remove unused error parameters entirely
try {
    // risky operation
} catch {
    // handle error without needing error details
    return false;
}

// âœ… Unused parameters
function processMove(_unused, toSquare) { /* ... */ }
```

### **Testing & Quality**
- **Jest Configuration** - ES modules with experimental VM support (NO deprecated flags)
- **ESLint & Prettier** - Synchronized flat config with `.prettierrc.json` and `eslint-config-prettier`
- **Error Handling** - Descriptive exceptions, no console pollution
- **Test Coverage** - All error paths and edge cases validated
- **Test Compatibility** - Update tests when implementing private fields or new APIs
- **Automated Linting** - Auto-fix workflow prevents CI failures from LLM code
- **ğŸ§¹ Code Cleanliness** - Remove unused variables entirely, follow strict no-unused-vars rule

### **File Structure**
```
src/
â”œâ”€â”€ core/          # Chess logic (Board, Piece, Game)
â”‚   â”œâ”€â”€ Board.js              # âœ… Enhanced (Issue #15)
â”‚   â”œâ”€â”€ Piece.js              # âœ… Implemented (ES2022 private fields)
â”‚   â”œâ”€â”€ Game.js               # âœ… Implemented
â”‚   â”œâ”€â”€ GameState.js          # âœ… Implemented
â”‚   â”œâ”€â”€ MoveGenerator.js      # âœ… All pieces implemented
â”‚   â”œâ”€â”€ MoveValidator.js      # ğŸ”§ FIXED - Enhanced integration + clean code
â”‚   â””â”€â”€ Rules.js              # âœ… Basic implementation
â”œâ”€â”€ ui/            # User interface (InputHandler, BoardRenderer)
â”‚   â”œâ”€â”€ BoardRenderer.js      # âœ… Implemented
â”‚   â”œâ”€â”€ InputHandler.js       # âœ… Implemented
â”‚   â””â”€â”€ styles.css            # âœ… Implemented
â”œâ”€â”€ ai/            # AI engine (Minimax, evaluation)
â”‚   â””â”€â”€ [TODO]                # Future implementation
â””â”€â”€ utils/         # Utilities (Constants, helpers)
    â””â”€â”€ Constants.js          # âœ… Implemented

tests/
â”œâ”€â”€ core/          # Core logic tests
â”‚   â”œâ”€â”€ Board.test.js         # âœ… Enhanced (Issue #15)
â”‚   â”œâ”€â”€ Piece.test.js         # âœ… Implemented
â”‚   â””â”€â”€ MoveGenerator.test.js # âœ… Implemented (All tests passing)
â”œâ”€â”€ ui/            # UI component tests
â””â”€â”€ ai/            # AI engine tests

.github/workflows/
â”œâ”€â”€ auto-fix.yml              # âœ… Automated LLM code quality fixes
â””â”€â”€ ci.yml                    # âœ… Main CI/CD pipeline

# Documentation Files
â”œâ”€â”€ README.md                 # âœ… Professional 16.9KB documentation
â”œâ”€â”€ CONTRIBUTING.md           # âœ… Comprehensive 10.7KB contributor guide
â”œâ”€â”€ llms.txt                  # âœ… LLM development guidelines
â””â”€â”€ llms_project_context.txt  # âœ… Current project status and priorities
```

---

## ğŸ” **DEVELOPMENT BEST PRACTICES**

### **Issue Management**
- **Atomic Issues** - One specific problem per issue
- **Clear Definitions** - Detailed problem description and acceptance criteria
- **Priority Levels** - Critical â†’ High â†’ Medium â†’ Low
- **Progress Tracking** - Regular status updates and completion verification

### **Code Quality Gates**
1. **ESLint passes** without errors or warnings (auto-fixed if needed)
2. **All tests pass** with 100% success rate
3. **Error handling** uses exceptions, not console output
4. **Documentation** updated for significant changes
5. **Performance** considerations for LLM integration
6. **Test compatibility** verified when modifying core components
7. **Automated fixes** applied for LLM-generated code quality issues
8. **ğŸ§¹ Clean code** - Remove unused variables entirely, follow strict ESLint rules

### **Integration Testing Protocol**
- **Dependency Mapping** - Before modifying core components, identify all dependent files
- **API Compatibility** - When changing public interfaces, update all consumers
- **Test Cascade** - Run tests for modified component AND all dependent components
- **Breaking Change Documentation** - Clearly document any API changes in commit messages

### **LLM Code Generation Best Practices**
- **Focus on Logic** - LLMs can focus on implementing functionality without worrying about minor linting
- **Trust Auto-Fix** - Let the automated workflow handle ESLint and Prettier issues
- **Verify Results** - Check that auto-fixes don't change intended logic
- **Quality Scripts** - Use `npm run quality:check` before major commits
- **ğŸ§¹ Clean Code Principle** - Remove unused variables entirely instead of working around them

---

## â™Ÿï¸ **CHESS ENGINE SPECIFICS**

### **Core Features**
- **64-square board representation** with piece positioning âœ…
- **Enhanced move tracking** with piece property updates âœ… (Issue #15)
- **Move validation** with chess rule enforcement ğŸ”§ **FIXED**
- **Game state tracking** including check/checkmate detection ğŸ”§ **ENHANCED**
- **Move notation** for game recording and analysis (TODO)

### **Move Generation Status**
- **âœ… Pawn Moves**: Fully implemented with comprehensive testing
- **âœ… Rook Moves**: Fully implemented with comprehensive testing
- **âœ… Bishop Moves**: Fully implemented with comprehensive testing
- **âœ… Knight Moves**: Fully implemented with comprehensive testing
- **âœ… King Moves**: Fully implemented with comprehensive testing
- **âœ… Queen Moves**: Fully implemented with comprehensive testing

### **Enhanced Board Logic & Move Validation (UPDATED)**
- **âœ… Move Execution**: Enhanced movePiece method with detailed result tracking
- **âœ… Piece Tracking**: Automatic marking of moved pieces (crucial for castling/pawn rules)
- **âœ… Capture Detection**: Comprehensive capture identification and reporting
- **âœ… Game Integration Ready**: Method designed for Game class orchestration
- **ğŸ”§ FIXED Move Validation**: Enhanced MoveValidator with robust integration
- **ğŸ”§ FIXED Check Detection**: Improved algorithms with comprehensive error handling
- **ğŸ”§ FIXED Checkmate/Stalemate**: Enhanced detection with proper legal move enumeration

### **AI Integration**
- **Position evaluation** for strategic decision making (TODO)
- **Move generation** with legal move filtering ğŸ”§ **ENHANCED**
- **Search algorithms** optimized for performance (TODO)
- **LLM-friendly APIs** for external AI agent integration ğŸ”§ **IMPROVED**

### **Performance Targets**
- **Sub-second move generation** for responsive gameplay
- **Memory efficient** board representation
- **Scalable architecture** for advanced AI features
- **Web Worker support** for non-blocking computation

---

## ğŸš€ **NEXT DEVELOPMENT PRIORITIES**

### **ğŸ¯ IMMEDIATE PRIORITY: Phase 3 - Core Game Logic (CONTINUING)**
**Status**: Enhanced Board Logic Complete âœ… + MoveValidator Integration Fixed ğŸ”§ â†’ Continuing Core Game Logic Phase

1. **Issue #14**: Orchestrate Game Flow with Game Class (**NEXT RECOMMENDED**)
2. **Advanced Move Validation**: Implement special moves (castling, en passant, promotion)
3. **Game State Management**: Complete turn management and game flow orchestration
4. **Integration Testing**: Comprehensive testing of all components working together

### **ğŸ§  Phase 4: AI & Advanced Features (Lower Priority)**
1. **AI Implementation**: Minimax with Alpha-Beta Pruning
2. **Advanced Rules**: Complete special moves implementation
3. **UI Enhancements**: Move highlighting, animations
4. **Performance**: Web Workers, transposition tables

### **ğŸ“Š Current Progress Summary (CORRECTED)**
- **Phase 1 (Documentation)**: âœ… **100% COMPLETE** (Issues #35-#38)
- **Phase 2 (Core Logic)**: âœ… **100% COMPLETE** (All piece moves implemented)
- **Phase 3 (Game Rules)**: ğŸ”„ **75% COMPLETE** (Issue #15 + MoveValidator fixes completed, continuing with Game orchestration)
- **Phase 4 (AI & Advanced)**: ğŸ“… **0% COMPLETE** (Future implementation)

---

## ğŸ”§ **TROUBLESHOOTING QUICK REFERENCE**

### **Common Jest Issues**
```bash
# âŒ Error: node: bad option: --harmony-private-fields
# âœ… Solution: Use modern Jest config (already fixed)
npm test

# âŒ Error: Cannot use import statement outside a module
# âœ… Solution: Ensure "type": "module" in package.json (already set)
```

### **Common Test Failures**
```javascript
// âŒ Error: Cannot read private member #field
// âœ… Solution: Use getter methods in tests
expect(piece.getType()).toBe('pawn');  // Not piece.type

// âŒ Error: Board wrapping validation
// âœ… Solution: Use correct wrapping examples (already fixed)
```

### **Auto-Fix Workflow Issues**
```bash
# âŒ Error: Auto-fix workflow fails
# âœ… Solution: Check workflow logs, ensure dependencies install correctly
# Auto-fix handles: ESLint errors, Prettier formatting, unused variables

# âŒ Error: Infinite loop in auto-fix
# âœ… Solution: [auto-fix] tag in commit message prevents loops (already implemented)
```

### **ESLint Code Quality Issues (RESOLVED)**
```javascript
// ğŸ§¹ BEST PRACTICE: Remove unused variables entirely
// âŒ WRONG: catch (error) { return false; }  // unused error parameter
// âŒ WRONG: catch (_error) { return false; } // still unused, just prefixed
// âœ… CORRECT: catch { return false; }        // clean, no unused variables

// ğŸ§¹ Follow project's strict .eslintrc.json no-unused-vars rule
// âœ… Solution: Remove unnecessary code rather than working around ESLint
// âœ… Solution: Use parameterless catch blocks when error details aren't needed
```

### **MoveValidator Integration Issues (RESOLVED)**
```javascript
// ğŸ”§ FIXED: Enhanced error handling and integration
// âœ… Solution: Comprehensive try-catch blocks and null safety checks
// âœ… Solution: Robust MoveGenerator integration with error recovery
// âœ… Solution: Enhanced checkmate/stalemate detection algorithms
// ğŸ§¹ Solution: Clean code with unused variables removed entirely
```

### **Enhanced Move Object Structure (IMPLEMENTED)**
```javascript
// Enhanced move object format (implemented in Issue #15)
const moveResult = {
    from: 12,              // Source square index (0-63)
    to: 28,                // Destination square index
    pieceMoved: 'pawn',    // Moving piece type
    pieceCaptured: 'knight', // Captured piece type (if any, null otherwise)
    success: true          // Move execution status
};
```

---

## ğŸ“š **REFERENCE RESOURCES**

- **Technical Guide** - `llms.txt` (comprehensive development guidelines)
- **Issue Tracker** - GitHub Issues for all development tasks
- **CI/CD Pipeline** - GitHub Actions with automated testing and auto-fixing
- **Code Standards** - ESLint flat config with ES2022 support

**This context provides the essential framework for efficient development while maintaining the chess engine's core objectives and technical excellence.**