# JS Chess Engine - Development Context

**Pure JavaScript chess engine inspired by Atari Video Chess, designed to enable LLMs to outplay the original Atari 2600 version through superior chess logic and AI.**

## ğŸš€ **PROJECT OBJECTIVES**

### **Core Goals**
- **Pure JavaScript Implementation** - Complete chess logic without external libraries
- **Advanced AI Engine** - Minimax with Alpha-Beta Pruning for intelligent gameplay
- **LLM Integration Ready** - Engine designed for AI agents to understand strategies and generate moves
- **Production Quality** - Modular, maintainable, performant codebase

### **Development Philosophy**
- **Issue-Driven Development** - All work tracked through GitHub Issues
- **Modular Architecture** - Core, UI, AI, Utils components with incremental development
- **AI-First Design** - Optimized for LLM collaboration and code generation

**Repository:** https://github.com/jane-alesi/js-chess-engine

**For comprehensive development guidelines, see `llms.txt` in the repository root.**

---

## ğŸ“Š **CURRENT PROJECT STATUS (June 2025)**

### **âœ… Completed Components**
- **Core Infrastructure**: Board.js, Piece.js (ES2022 private fields), Game.js, GameState.js
- **UI Foundation**: BoardRenderer.js, InputHandler.js, styles.css
- **Utilities**: Constants.js with comprehensive piece definitions and helper functions
- **Move Generation**: **Pawn, Rook, Bishop, Knight, King and Queen moves fully implemented** (Issues #4, #2, #1, #9, #7, #6 âœ…)
- **Testing Framework**: Jest configuration with ES module support
- **Security**: Comprehensive dependency security fixes and npm overrides
- **Automated Linting**: Fully synchronized auto-linting/formatting pipeline (ESLint + Prettier) (Issue #19 âœ…)
- **ğŸ“‹ DOCUMENTATION PHASE COMPLETE**: Professional README.md with comprehensive project documentation (Issues #35-#38 âœ…)

### **ğŸ§ª Test Suite Status**
- **All tests passing** âœ…
- **Comprehensive pawn, rook, bishop, knight, king and queen move generation tests** with edge cases
- **Jest configuration modernized** for Node.js compatibility
- **Test compatibility verified** with ES2022 private fields

### **ğŸ”§ Recent Critical Fixes**
- **Jest Configuration**: Removed deprecated `--harmony-private-fields` flag
- **Test Cases**: Fixed board wrapping validation logic
- **Security**: Updated all vulnerable dependencies with npm overrides
- **ESLint & Prettier**: Synchronized tooling with `.prettierrc.json` and `eslint-config-prettier` to resolve all style conflicts
- **CI/CD Pipeline**: Implemented robust, multi-stage CI workflow that correctly handles auto-fix commits, race conditions, and dependency installation order

### **ğŸ“ Documentation Foundation Complete**
- **âœ… Professional README.md** (Issue #35) - Impactful header, project description, and vision
- **âœ… Installation & Usage Guide** (Issue #36) - Comprehensive setup and development instructions
- **âœ… Architecture Documentation** (Issue #37) - Mermaid diagrams, CONTRIBUTING.md (10.7KB), and technical framework
- **âœ… Status Badges & Roadmap** (Issue #38) - 8 dynamic status badges and 6-phase development roadmap
- **ğŸ“Š README Growth**: From 2.5KB â†’ 16.9KB with world-class professional documentation
- **ğŸ¯ Project Credibility**: Complete documentation foundation suitable for portfolio and enterprise use

---

## âš¡ **CRITICAL WORKFLOWS**

### **ğŸ”§ File Update Protocol (MANDATORY)**
```javascript
// ALWAYS follow this exact sequence
const fileData = await get_file_contents(owner, repo, path);
const currentSHA = fileData.sha;
await create_or_update_file(owner, repo, path, content, message, branch, currentSHA);
```

### **ğŸ§  Cortex Memory System Protocol**

**CRITICAL**: The `read_graph` function requires specific parameter structure for correct initialization:

```javascript
// âœ… CORRECT: Use explicit parameter structure
read_graph({"properties": {}})

// âŒ INCORRECT: Will cause "Invalid JSON format" error
read_graph()
read_graph({})
```

**Initialization Sequence:**
1. Always attempt cortex initialization at conversation start
2. Use exact JSON parameter structure to prevent parsing errors
3. Implement fallback strategies for initialization failures
4. Verify successful memory integration before proceeding

### **ğŸ”§ GitHub File Update Protocol (Enhanced)**

**CRITICAL**: When updating EXISTING files, ALWAYS provide the SHA to prevent 422 errors:

```javascript
// âœ… CORRECT: SHA-based update sequence
const fileData = await get_file_contents(owner, repo, path);
const currentSHA = fileData.sha;
await create_or_update_file(owner, repo, path, content, message, branch, currentSHA);

// âŒ INCORRECT: Missing SHA causes error
// Error: MCP plugin run error: Failed to call tool: {"error":"Failed to call tool","details":"MCP error -32603: failed to create/update file: PUT https://api.github.com/repos/jane-alesi/js-chess-engine/contents/FILE_TO_UPDATE: 422 Invalid request.\\\\n\\\\n\\\\\\\\\"sha\\\\\\\\\" wasn't supplied. []"}
```

**Update Workflow:**
1. Get current file contents and SHA using `get_file_contents`
2. Extract SHA from response: `const currentSHA = fileData.sha`
3. Include SHA in `create_or_update_file` call as final parameter
4. Verify successful update completion

### **ğŸ¤– Automated LLM Code Quality Protocol (NEW & IMPROVED)**

**CRITICAL**: The project now includes a fully synchronized, automated code quality workflow.

```yaml
# Auto-fix workflow (.github/workflows/auto-fix.yml)
# - Runs before main CI pipeline
# - Automatically formats and fixes ESLint issues
# - Commits fixes back to branch with [auto-fix] tag
# - Prevents CI failures from LLM code generation
```

**LLM Development Workflow:**
1. **Generate Code**: LLMs can generate code without worrying about minor linting or formatting issues.
2. **Auto-Fix Triggers**: Push/PR automatically triggers the auto-fix workflow.
3. **Automatic Fixes**: Prettier and ESLint are run in the correct order to automatically format and fix the code.
4. **Auto-Commit**: Fixed code is committed back to the branch with an `[auto-fix]` message.
5. **CI Validation**: The main CI pipeline runs on the *already fixed* code, ensuring a smooth and reliable build.

**Enhanced Scripts Available:**
```bash
npm run quality:check    # Check both formatting and linting
npm run quality:fix      # Fix both formatting and linting (Prettier runs first)
npm run lint:check       # Check linting with zero warnings
npm run format:check     # Check formatting without fixing
```

### **ğŸ§ª Jest Test Execution (UPDATED 2025)**
```bash
# âœ… CORRECT: Modern Jest configuration
npm test

# Test scripts (package.json):
"test": "node --experimental-vm-modules --no-warnings node_modules/jest/bin/jest.js"
"test:watch": "node --experimental-vm-modules --no-warnings node_modules/jest/bin/jest.js --watch"
"test:coverage": "node --experimental-vm-modules --no-warnings node_modules/jest/bin/jest.js --coverage"

# âŒ DEPRECATED: Do not use --harmony-private-fields (causes errors)
```

### **ğŸ§ª Test Compatibility Protocol (MANDATORY)**
```javascript
// When modifying core components with private fields or new APIs:
const testUpdateWorkflow = {
    1: "Identify all dependent test files before making changes",
    2: "Update tests to use getter methods instead of direct property access",
    3: "Run full test suite to verify compatibility",
    4: "Document breaking changes in commit message",
    5: "Update any integration tests that depend on the modified component"
};

// Example: After implementing private fields in Piece.js
// âŒ OLD: expect(piece.type).toBe('pawn');
// âœ… NEW: expect(piece.getType()).toBe('pawn');

// Integration test updates
// âŒ OLD: expect(board.squares[8].color).toBe('white');
// âœ… NEW: expect(board.squares[8].getColor()).toBe('white');
```

### **ğŸ“ Move Object Structure (STANDARDIZED)**
```javascript
// Standardized move object format (implemented in Issue #4)
const moveObject = {
    from: 12,              // Source square index (0-63)
    to: 28,                // Destination square index
    type: 'normal',        // 'normal', 'double', 'capture', 'castling', 'enPassant'
    piece: 'pawn',         // Moving piece type
    color: 'white',        // Moving piece color
    captured: 'knight'     // Captured piece type (if any)
};
```

---

## ğŸ› ï¸ **TECHNICAL STANDARDS (2025)**

### **JavaScript/ES2022**
```javascript
// âœ… Modern class fields syntax with private fields
class ChessEngine {
    static PIECE_TYPES = ['pawn', 'rook', 'knight', 'bishop', 'queen', 'king'];

    // Private fields for encapsulation
    #privateField = 'value';
    #gameState;
    #currentPlayer = 'white';

    constructor() {
        this.#gameState = new GameState();
    }

    // Public getter methods for private fields
    getCurrentPlayer() { return this.#currentPlayer; }
    getGameState() { return this.#gameState; }
}

// âœ… Comprehensive input validation with descriptive errors
function validateMove(fromIndex, toIndex) {
    if (typeof fromIndex !== 'number' || fromIndex < 0 || fromIndex >= 64) {
        throw new Error(`Invalid move: fromIndex ${fromIndex} must be 0-63`);
    }
    if (typeof toIndex !== 'number' || toIndex < 0 || toIndex >= 64) {
        throw new Error(`Invalid move: toIndex ${toIndex} must be 0-63`);
    }
}

// âœ… Proper error handling
throw new Error(`Invalid move: ${details}`);  // Not console.warn()

// âœ… Unused parameters
function processMove(_unused, toSquare) { /* ... */ }
```

### **Testing & Quality**
- **Jest Configuration** - ES modules with experimental VM support (NO deprecated flags).
- **ESLint & Prettier** - Synchronized flat config with `.prettierrc.json` and `eslint-config-prettier`.
- **Error Handling** - Descriptive exceptions, no console pollution.
- **Test Coverage** - All error paths and edge cases validated.
- **Test Compatibility** - Update tests when implementing private fields or new APIs.
- **Automated Linting** - Auto-fix workflow prevents CI failures from LLM code.

### **File Structure**
```
src/
â”œâ”€â”€ core/          # Chess logic (Board, Piece, Game)
â”‚   â”œâ”€â”€ Board.js              # âœ… Implemented
â”‚   â”œâ”€â”€ Piece.js              # âœ… Implemented (ES2022 private fields)
â”‚   â”œâ”€â”€ Game.js               # âœ… Implemented
â”‚   â”œâ”€â”€ GameState.js          # âœ… Implemented
â”‚   â”œâ”€â”€ MoveGenerator.js      # âœ… All pieces implemented
â”‚   â”œâ”€â”€ MoveValidator.js      # âœ… Basic implementation
â”‚   â””â”€â”€ Rules.js              # âœ… Basic implementation
â”œâ”€â”€ ui/            # User interface (InputHandler, BoardRenderer)
â”‚   â”œâ”€â”€ BoardRenderer.js      # âœ… Implemented
â”‚   â”œâ”€â”€ InputHandler.js       # âœ… Implemented
â”‚   â””â”€â”€ styles.css            # âœ… Implemented
â”œâ”€â”€ ai/            # AI engine (Minimax, evaluation)
â”‚   â””â”€â”€ [TODO]                # Future implementation
â””â”€â”€ utils/         # Utilities (Constants, helpers)
    â””â”€â”€ Constants.js          # âœ… Implemented

tests/
â”œâ”€â”€ core/          # Core logic tests
â”‚   â”œâ”€â”€ Board.test.js         # âœ… Implemented
â”‚   â”œâ”€â”€ Piece.test.js         # âœ… Implemented
â”‚   â””â”€â”€ MoveGenerator.test.js # âœ… Implemented (All tests passing)
â”œâ”€â”€ ui/            # UI component tests
â””â”€â”€ ai/            # AI engine tests

.github/workflows/
â”œâ”€â”€ auto-fix.yml              # âœ… Automated LLM code quality fixes
â””â”€â”€ ci.yml                    # âœ… Main CI/CD pipeline

# Documentation Files
â”œâ”€â”€ README.md                 # âœ… Professional 16.9KB documentation
â”œâ”€â”€ CONTRIBUTING.md           # âœ… Comprehensive 10.7KB contributor guide
â”œâ”€â”€ llms.txt                  # âœ… LLM development guidelines
â””â”€â”€ llms_project_context.txt  # âœ… Current project status and priorities
```

---

## ğŸ” **DEVELOPMENT BEST PRACTICES**

### **Issue Management**
- **Atomic Issues** - One specific problem per issue
- **Clear Definitions** - Detailed problem description and acceptance criteria
- **Priority Levels** - Critical â†’ High â†’ Medium â†’ Low
- **Progress Tracking** - Regular status updates and completion verification

### **Code Quality Gates**
1. **ESLint passes** without errors or warnings (auto-fixed if needed).
2. **All tests pass** with 100% success rate.
3. **Error handling** uses exceptions, not console output.
4. **Documentation** updated for significant changes.
5. **Performance** considerations for LLM integration.
6. **Test compatibility** verified when modifying core components.
7. **Automated fixes** applied for LLM-generated code quality issues.

### **Integration Testing Protocol**
- **Dependency Mapping** - Before modifying core components, identify all dependent files.
- **API Compatibility** - When changing public interfaces, update all consumers.
- **Test Cascade** - Run tests for modified component AND all dependent components.
- **Breaking Change Documentation** - Clearly document any API changes in commit messages.

### **Collaboration Protocol**
- **SHA-based updates** - Always get current SHA before file modifications.
- **Verification steps** - Confirm operations completed successfully.
- **Error recovery** - Implement retry strategies for tool failures.
- **Research validation** - Verify best practices through online research.
- **LLM-friendly workflow** - Auto-fix handles minor code quality issues automatically.

### **LLM Code Generation Best Practices**
- **Focus on Logic** - LLMs can focus on implementing functionality without worrying about minor linting.
- **Trust Auto-Fix** - Let the automated workflow handle ESLint and Prettier issues.
- **Verify Results** - Check that auto-fixes don't change intended logic.
- **Quality Scripts** - Use `npm run quality:check` before major commits.

---

## â™Ÿï¸ **CHESS ENGINE SPECIFICS**

### **Core Features**
- **64-square board representation** with piece positioning âœ…
- **Move validation** with chess rule enforcement (partial)
- **Game state tracking** including check/checkmate detection (basic)
- **Move notation** for game recording and analysis (TODO)

### **Move Generation Status**
- **âœ… Pawn Moves**: Fully implemented with comprehensive testing
- **âœ… Rook Moves**: Fully implemented with comprehensive testing
- **âœ… Bishop Moves**: Fully implemented with comprehensive testing
- **âœ… Knight Moves**: Fully implemented with comprehensive testing
- **âœ… King Moves**: Fully implemented with comprehensive testing
- **âœ… Queen Moves**: Fully implemented with comprehensive testing

### **AI Integration**
- **Position evaluation** for strategic decision making (TODO)
- **Move generation** with legal move filtering (partial)
- **Search algorithms** optimized for performance (TODO)
- **LLM-friendly APIs** for external AI agent integration (partial)

### **Performance Targets**
- **Sub-second move generation** for responsive gameplay
- **Memory efficient** board representation
- **Scalable architecture** for advanced AI features
- **Web Worker support** for non-blocking computation

---

## ğŸš€ **NEXT DEVELOPMENT PRIORITIES**

### **ğŸ¯ IMMEDIATE PRIORITY: Phase 3 - Core Game Logic**
**Status**: Core Move Generation Complete âœ… â†’ Now in Core Game Logic Phase

1. **Issue #15**: Enhance Board.js movePiece for Game Logic (**RECOMMENDED NEXT**)
2. **Issue #14**: Orchestrate Game Flow with Game Class (if needed)
3. **Move Validation**: Implement self-check prevention
4. **Check Detection**: Implement check/checkmate logic

### **ğŸ§  Phase 4: AI & Advanced Features (Lower Priority)**
1. **AI Implementation**: Minimax with Alpha-Beta Pruning
2. **Advanced Rules**: Castling, en passant, promotion
3. **UI Enhancements**: Move highlighting, animations
4. **Performance**: Web Workers, transposition tables

### **ğŸ“Š Current Progress Summary**
- **Phase 1 (Documentation)**: âœ… **100% COMPLETE** (Issues #35-#38)
- **Phase 2 (Core Logic)**: âœ… **100% COMPLETE** (All piece moves implemented)
- **Phase 3 (Game Rules)**: ğŸ“… **0% COMPLETE** (Awaiting Phase 2)
- **Phase 4 (AI & Advanced)**: ğŸ“… **0% COMPLETE** (Future implementation)

---

## ğŸ“š **REFERENCE RESOURCES**

- **Technical Guide** - `llms.txt` (comprehensive development guidelines)
- **Issue Tracker** - GitHub Issues for all development tasks
- **CI/CD Pipeline** - GitHub Actions with automated testing and auto-fixing
- **Code Standards** - ESLint flat config with ES2022 support

## ğŸ”§ **TROUBLESHOOTING QUICK REFERENCE**

### **Common Jest Issues**
```bash
# âŒ Error: node: bad option: --harmony-private-fields
# âœ… Solution: Use modern Jest config (already fixed)
npm test

# âŒ Error: Cannot use import statement outside a module
# âœ… Solution: Ensure "type": "module" in package.json (already set)
```

### **Common Test Failures**
```javascript
// âŒ Error: Cannot read private member #field
// âœ… Solution: Use getter methods in tests
expect(piece.getType()).toBe('pawn');  // Not piece.type

// âŒ Error: Board wrapping validation
// âœ… Solution: Use correct wrapping examples (already fixed)
```

### **Auto-Fix Workflow Issues**
```bash
# âŒ Error: Auto-fix workflow fails
# âœ… Solution: Check workflow logs, ensure dependencies install correctly
# Auto-fix handles: ESLint errors, Prettier formatting, unused variables

# âŒ Error: Infinite loop in auto-fix
# âœ… Solution: [auto-fix] tag in commit message prevents loops (already implemented)
```

**This context provides the essential framework for efficient development while maintaining the chess engine's core objectives and technical excellence.**
